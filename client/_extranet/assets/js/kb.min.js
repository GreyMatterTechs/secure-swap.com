"use strict";!function(w,t){if(w.ssw=w.ssw||{},void 0===w.ssw.Tools)throw new Error("Please load Tools.js");w.ssw.Kb=function(){throw new Error("Please use getInstance")},w.ssw.Kb.getInstance=function(){return e||(e=new a)};var e=null,a=function(){var e=5e3,a=e,t=null,i=null,c=null,d=$("#add-categories"),l=$("#add-tags"),u=$("#add-title"),f=$("#add-text"),g=!1,n=!1,m=[],v=[],s=null;function p(){$.notify({icon:"_extranet/assets/images/timeout.png",title:"Session time out!",message:'Your session period is now over.<br />Please <span class="blue">Login</span> again.'},{type:"minimalist",placement:{from:"top",align:"right"},delay:5e3,animate:{enter:"animated fadeInLeftBig",exit:"animated fadeOutLeftBig"},icon_type:"image",template:'<div data-notify="container" class="alert alert-{0}" role="alert">\t<button type="button" aria-hidden="true" class="close" data-notify="dismiss">Ã—</button>\t<div id="image">\t\t<img data-notify="icon" class="rounded-circle float-left" />\t</div>\t<div id="text">\t\t<span data-notify="title">{1}</span>\t\t<span data-notify="message">{2}</span>\t</div></div>'})}function h(){t&&clearInterval(t),$.get("/api/Categories").done(function(t){a=e,t.forEach(function(t){d.tagsinput("add",{value:t.name,checked:!1})}),d.tagsinput("refresh")}).fail(function(t){a<100*e&&(a*=2)}),t=setInterval(h,a)}function r(t){return t.reduce(function(t,e){return e&&(t[e]=(t[e]||0)+1),t},{})}function b(t,e){return t.some(function(t){return t.value===e})}function y(){if(g){l.tagsinput("removeAll");var t=$("#add-text").val();if(t){var e=(s=t,XRegExp.match(s,XRegExp("[\\pL\\pN]+","g"))).filter(function(t,e,a){return!t.toLowerCase().endsWith("s")||(t=t.slice(0,-1),a.indexOf(t)<0)}),a=r(e);Object.keys(a).forEach(function(t,e){(t.length<3||!/^[A-Z0-9]+$/.test(t))&&delete this[t]},a),Object.keys(a).sort(function(t,e){return a[e]-a[t]}).slice(0,3).forEach(function(t){b(m,t)||l.tagsinput("add",{value:t,type:"accro"})});var n=new Set(e);Array.from(n).sort(function(t,e){return e.length-t.length}).slice(0,3).forEach(function(t){b(m,t)||l.tagsinput("add",{value:t,type:"wider"})});var i=r(e);Object.keys(i).forEach(function(t,e){(t.length<=5||this[t]<2)&&delete this[t]},i),Object.keys(i).sort(function(t,e){return i[e]==i[t]?e.length-t.length:i[e]-i[t]}).slice(0,3).forEach(function(t){b(m,t)||l.tagsinput("add",{value:t,type:"most"})})}else m=[],v=[];v.forEach(function(t){l.tagsinput("add",t)}),l.tagsinput("refresh")}var s}function x(){if(n){var t=$.trim($("#search").val());t&&$.ajax({url:"/api/KBs/search",type:"POST",data:{tokenId:c,words:t}}).done(function(t){$("#pagination-container").pagination({dataSource:t,pageSize:3,callback:function(t,e){var a=function(t){for(var e="",a=JSON.parse(JSON.stringify(t)),n=0;n<a.length;n++){for(var i=a[n],s=i.matches,r=0;r<s.length;r++){var o=s[r];if("title"===o.key||"text"===o.key)for(var c=0,d=0;d<o.indices.length;d++){var l=o.indices[d],u={};u[l[0]+c]='<span class="hlt">',u[l[1]+c+1]="</span>",i.item[o.key]=i.item[o.key].insertTextAtIndices(u),c+=25}}e+='<section class="card">\t<div class="card-content">\t\t<div class="card-body">\t\t\t<div class="d-flex mb-1">\t\t\t\t<div class="flex-grow-1"><b>'+i.item.title+'</b></div>\t\t\t\t<div class="">[ '+i.item.categories.toString()+' ]</div>\t\t\t</div>\t\t\t<div class="d-flex">\t\t\t\t<div class="kb-text">'+i.item.text.replace(/\n/g,"<br />")+'</div>\t\t\t</div>\t\t\t<div class="kb-button align-items-end"><a href="#" data-toggle="modal" data-target="#kb-view" data-index="'+n+'" class="btn-sm btn btn-outline-warning round">More...</a></div>\t\t</div>\t</div></section>'}return e}(s=t);$("#kb-container").html(a)}})}).fail(function(t){401===t.status?(p(),$("#search").blur()):console.log(t)})}}return String.prototype.insertTextAtIndices=function(a){return this.replace(/./g,function(t,e){return a[e]?a[e]+t:t})},{init:function(r,t,e){t||5e3,c=e,i=w.ssw.Tools.getInstance(),d.tagsinput({checkbox:!0,itemValue:"value"}),h(),d.on("itemAdded",function(t){"manual"===t.item.type&&$.ajax({url:"/api/Categories/add",type:"POST",data:{tokenId:c,category:t.item.value}}).done(function(){}).fail(function(t){})}),l.tagsinput({tagClass:function(t){switch(t.type){case"wider":return"badge-primary";case"accro":return"badge-secondary";case"most":return"badge-warning";case"manual":return"badge-success"}},itemValue:"value"}),l.on("itemAdded",function(t){"manual"===t.item.type&&(b(v,t.item)||v.push(t.item))}),l.on("itemRemoved",function(e){"manual"===e.item.type?v=v.filter(function(t){return t.value!=e.item.value}):m.push(e.item)}),setInterval(y,1e3),$("#add-text").blur(function(){g=!1}),$("#add-text").focus(function(){g=!0});var o=document.getElementById("form-add");$("#add-tags-submit").click(function(t){if(t.preventDefault(),t.stopPropagation(),o.checkValidity()){var e=u.val(),a=f.val(),n=d.tagsinput("items").map(function(t){return t.checked?t.value:null});n=n.filter(function(t){if(t)return!0});var i=l.tagsinput("items"),s={title:e,categories:n,tags:i=i.map(function(t){return t.value}),text:a,author:r,date:new Date};$.ajax({url:"/api/KBs/add",type:"POST",data:{tokenId:c,kb:s}}).done(function(){m=[],v=[],u.val(""),f.val(""),l.tagsinput("removeAll"),d.tagsinput("uncheckAll"),o.classList.remove("was-validated"),$("#add-tags-submit").text("Thank you").removeClass("btn-gradient-primary").addClass("btn-gradient-secondary"),setTimeout(function(){$("#add-tags-submit").text("Save this awesome information").removeClass("btn-gradient-secondary").addClass("btn-gradient-primary")},1e3)}).fail(function(t){401===t.status?(p(),l.blur(),u.blur(),f.blur()):console.log(t),$("#add-tags-submit").text("Save this awesome information")})}o.classList.add("was-validated")}),setInterval(x,1e3),$("#search").blur(function(){n=!1}),$("#search").focus(function(){n=!0}),$("#kb-view").on("show.bs.modal",function(t){var a=$(t.relatedTarget).data("index"),n=$(this);s&&$.each(s,function(t,e){t===a&&(n.find(".kb-title").text(e.item.title),n.find(".kb-author").text("Posted by: "+i.ucfirst(e.item.author)+", on: "+moment(e.item.date).format("LL")),n.find(".view-categories").text("Categories: "+e.item.categories.toString()),n.find(".kb-text").html(e.item.text.replace(/\n/g,"<br />")))})})}}}}(window);